<p-panel [toggleable]="true">
  <ng-template pTemplate="header"><span class="text-primary font-semibold text-xl">Основные учетные данные пользователя</span>
  </ng-template>
  <ng-template pTemplate="content">
    <div class="mb-2 font-bold">Аккаунт создан: <span
      class="font-normal">{{userProfile.createdAt.toString() | date:'full':'ru' }}</span></div>
    <div class="mb-2 font-bold">Последнее изменение: <span
      class="font-normal">{{userProfile.updatedAt.toString() | date:'full':'ru' }} </span></div>
    <div class="mb-4 font-bold">Статус аккаунта: <span [ngClass]="userStatusClasses" class="font-normal font-italic">{{userStatus() }}</span></div>
    <form
      class="mt-1"
      [formGroup]="userForm"
      novalidate
      (ngSubmit)="submitUserFrm()">
      <div class="flex justify-content-start align-items-center">
        <span class="p-float-label w-20rem">
          <input
            pInputText
            id="email"
            class="p-inputtext-sm w-full"
            formControlName="emailControl"
            (focusout)="checkEmail()"
            [ngClass]="{'ng-invalid ng-dirty':(emailControl.invalid)&&emailControl.touched}"
          />
         <label htmlFor="email">Email</label>
        </span>
        <span class="ml-2">
          <span *ngIf="userProfile.isEmailVerified&&!emailControlChanged"
                class="font-italic font-semibold text-green-400">Почта подтверждена</span>
          <span *ngIf="!userProfile.isEmailVerified&&!emailControlChanged">
            <p-button
              label="Подтвердить почту"
              styleClass="p-button-raised ml-5"
              [loading]="sendEmailVerifyTokenLoaded"
              (click)="sendEmailVerifyToken()"></p-button>
          </span>
        </span>
      </div>
      <div class="flex justify-content-start align-items-center">
        <div>
            <span class="p-float-label mt-4">
              <p-inputMask
                mask="+7(999) 999-9999"
                id="phone"
                formControlName="phoneControl"
                (focusout)="checkPhone()"
                [ngClass]="{'ng-invalid ng-dirty':(phoneControl.invalid)&&phoneControl.touched}"
              ></p-inputMask>
              <label htmlFor="phone">Телефон</label>
            </span>
        </div>
        <span *ngIf="userProfile.isPhoneVerified&&!phoneControlChanged"
              class="font-italic font-semibold text-green-400 mt-4">Телефон подтвержден</span>
        <span *ngIf="!userProfile.isPhoneVerified&&!phoneControlChanged" class="mt-4">
            <p-button
              label="Подтвердить телефон"
              styleClass="p-button-raised ml-5"
              [loading]="sendPhoneVerifyTokenLoaded"
              (click)="sendPhoneVerifyToken()"></p-button>
          </span>
        <span *ngIf="!phoneControl.value" class="mt-4">
            Введите номер Вашего телефона.
          </span>
      </div>
      <div class="mt-4">
        <p>Каждые {{pswStrangeReq.passwordExpired}} месяцев, в соответствии с настройками установленными Администратором, необходимо менять пароль.</p>
        <p>Текущий Ваш пароль можно использовать для входа в приложение до <span class="font-bold">{{userProfile.credentialExpiredTime.toString() | date:'short':'ru'}}.</span></p>
        <p>По истечению этого времени войти в приложение с этим паролем будет невозможно.</p>
      </div>
      <p-button
        label="Сменить пароль"
        styleClass="p-button-raised mt-3"
        (click)="changePassword()"></p-button>
      <div class="mt-4">
        <span class="font-bold">Вам назначены следующие роли:</span>
        <p-table [value]="userProfile.roles" [tableStyle]="{ 'width': '100%','margin-top':'1rem' }">
          <ng-template pTemplate="header">
            <tr>
              <th>Название </th>
              <th>Описание роли</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body">
            <tr *ngFor="let row of userProfile.roles">
              <td>{{row.title}}</td>
              <td>{{row.description}}</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
      <p-button
        label="Сохранить изменения"
        styleClass="p-button-raised mt-3"
        [loading]="userFormLoading"
        [disabled]="!userFormChanged"
        (click)="submitUserFrm()"></p-button>
    </form>
  </ng-template>
</p-panel>
<p-dialog header="Изменить пароль"
          [(visible)]="visibleChangePswForm"
          [modal]="true"
          [style]="{ width: '34rem' }"
          [position]="position"
          [draggable]="true"
          [resizable]="false">
  <div>
    <p>Пароль должен соответствовать следующим требованиям:</p>
    <div *ngIf="pswStrangeReq.minCharacters!=0"> - минимальная длина пароля - <span
      class="font-bold text-red-800">{{pswStrangeReq.minCharacters}}</span></div>
    <div *ngIf="pswStrangeReq.minLowerCase!=0"> - минимально прописных символов - <span
      class="font-bold text-red-800">{{pswStrangeReq.minLowerCase}}</span></div>
    <div *ngIf="pswStrangeReq.minUpperCase!=0"> - минимально заглавных символов - <span
      class="font-bold text-red-800">{{pswStrangeReq.minUpperCase}}</span></div>
    <div *ngIf="pswStrangeReq.minNumber!=0"> - минимально количество цифр - <span
      class="font-bold text-red-800">{{pswStrangeReq.minNumber}}</span></div>
    <div *ngIf="pswStrangeReq.minSymbol!=0"> - минимально количество спецсимволов($@!%*?&) - <span
      class="font-bold text-red-800">{{pswStrangeReq.minSymbol}}</span></div>
  </div>
  <form class="mt-4"
        [formGroup]="passwordChangeForm"
        novalidate
        (ngSubmit)="submitPasswordFrm()">
        <span class="p-float-label">
          <p-password
            id="newPassword"
            class="w-full" [feedback]="false"
            styleClass="p-password p-component p-inputwrapper p-input-icon-right"
            [style]="{'width':'100%'}"
            [inputStyle]="{'width':'100%'}"
            [toggleMask]="true"
            formControlName="passwordControl"
            [ngClass]="{'ng-invalid ng-dirty':(passwordControl.hasError('required')||passwordControl.hasError('passwordStrange'))&&passwordControl.touched}"
          ></p-password>
          <label htmlFor="newPassword">Пароль</label>
        </span>
        <span class="p-float-label mt-4">
          <p-password
            id="repeatPassword"
            class="w-full"
            [feedback]="false"
            styleClass="p-password p-component p-inputwrapper p-input-icon-right"
            [style]="{'width':'100%'}"
            [inputStyle]="{'width':'100%'}"
            [toggleMask]="true"
            formControlName="confirmPasswordControl"
            [ngClass]="{'ng-invalid ng-dirty':(confirmPasswordControl.hasError('required')||passwordChangeForm.hasError('match_error'))&&confirmPasswordControl.touched}"
          ></p-password>
          <label htmlFor="repeatPassword">Повторите пароль</label>
        </span>
    <div class="mt-4 flex justify-content-center">
    <p-button
      label="Сменить пароль"
      styleClass="p-button-raised "
      [loading]="loadingPasswordChangeForm"
      [disabled]="loadingPasswordChangeForm"
      (click)="submitPasswordFrm()"></p-button>
    </div>
  </form>
</p-dialog>
<p-toast></p-toast>
